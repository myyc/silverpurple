---
# yaml-language-server: $schema=https://schema.blue-build.org/module-list-v1.json
modules:
  # OS branding (base values, build-info.sh adds version)
  - type: os-release
    properties:
      NAME: Silverpurple

  # Add build timestamp/hash to os-release
  - type: script
    scripts:
      - build-info.sh

  # Signing policy (baked into image for automatic verification)
  - type: signing

  # Nerd Fonts
  - type: fonts
    fonts:
      nerd-fonts:
        - JetBrainsMono

  # GNOME settings defaults
  - type: gschema-overrides
    include:
      - zz1-silverpurple.gschema.override

  # ntsync kernel module (Wine/Proton compatibility)
  - type: files
    files:
      - source: modules-load.d
        destination: /etc/modules-load.d
      - source: udev-rules
        destination: /etc/udev/rules.d

  # Repositories: RPM Fusion (via dnf module) and Mullvad
  - type: dnf
    repos:
      nonfree: rpmfusion
      files:
        - https://repository.mullvad.net/rpm/stable/mullvad.repo

  # Packages
  - type: rpm-ostree
    remove:
      - firefox
      - firefox-langpacks
      - ffmpeg-free
      - libavcodec-free
      - libavdevice-free
      - libavfilter-free
      - libavformat-free
      - libavutil-free
      - libpostproc-free
      - libswresample-free
      - libswscale-free
      - mesa-va-drivers
    install:
      # Codecs and drivers (from RPM Fusion)
      - ffmpeg
      - ffmpegthumbnailer
      - mesa-va-drivers-freeworld
      - mesa-vdpau-drivers-freeworld
      - pipewire-codec-aptx
      # Fonts
      - google-noto-fonts-all-vf
      # Terminal tools
      - alacritty
      - fish
      - tmux
      - bat
      - lsd
      # Dev tools
      - nmap
      - tcpdump
      # Services
      - mullvad-vpn
      - nebula
      - syncthing

  # Disable rpm-ostree auto-updates, enable bootc auto-updates
  - type: systemd
    system:
      disabled:
        - rpm-ostreed-automatic.timer
      enabled:
        - bootc-fetch-apply-updates.timer

  # Flatpak config - remove Fedora remote and all system flatpaks
  - type: default-flatpaks@v1
    system:
      repo-url: ""
      repo-name: ""
      repo-title: ""
      install: []
      remove:
        - fedora
        # Remove all default Silverblue flatpaks (from pungi-fedora config)
        - org.gnome.baobab
        - org.gnome.Calculator
        - org.gnome.Calendar
        - org.gnome.Characters
        - org.gnome.Snapshot
        - org.gnome.clocks
        - org.gnome.Connections
        - org.gnome.Contacts
        - org.gnome.Extensions
        - org.gnome.font-viewer
        - org.gnome.TextEditor
        - org.gnome.Loupe
        - org.gnome.Logs
        - org.gnome.Maps
        - org.fedoraproject.MediaWriter
        - org.gnome.NautilusPreviewer
        - org.gnome.Papers
        - org.gnome.Weather
    user:
      repo-url: https://dl.flathub.org/repo/flathub.flatpakrepo
      repo-name: flathub
      repo-title: Flathub
      install:
        - org.mozilla.firefox
        - org.gnome.Calculator
        - org.gnome.Calendar
        - org.gnome.Contacts
        - org.gnome.Loupe
        - org.gnome.NautilusPreviewer
        - org.gnome.Papers
        - org.gnome.Weather
        - org.gnome.font-viewer
        - com.belmoussaoui.Authenticator
        - com.mattjakeman.ExtensionManager
        - org.gtk.Gtk3theme.adw-gtk3
        - org.gtk.Gtk3theme.adw-gtk3-dark
